---
title: 小飞机被查水表的故事
date: 2018-06-29 17:10:11
tags:
---

# 小飞机被查水表的故事
这是蓝色小飞机从出生到被查水表的漫长路途，游历全世界的传奇人生，没有进不去的站，穿不过的墙，只要和小飞机一样有一个钻漏洞的决心和毅力，每个人都能拥有一个属于自己的路线。
只眼看世界，小飞机（~~代理~~）带你科学上网，游遍全球！

QQ群：["518525221"](./images/NinNin.png)

<!-- more -->

## 从造房子开始
蓝色小飞机自从很久以前 clowwindy 创造它以来，就生活在 https://github.com/clowwindy/shadowsocks 的温暖家中，直到有一天，发生了意外，蓝色小飞机的父亲发生了意外，小飞机无家可归，从此过着颠沛流离的生活。
小飞机并没有放弃，在 github 的众多热心人的帮助下，不断成长，至今仍然活着！并且为更多的人提供周游世界的服务！想和小飞机一起周游世界吗？那么先给小飞机造一个房子吧！
有房子的可以跳过哦。

### 买地基
小飞机喜欢漫游在 Linux 的土地上，首先需要一个 VPS 作为地基，出售 VPS 的房地产商有很多，这里列举一些

- [DigitalOcean](https://www.digitalocean.com/)
- [BandwagongHOST](https://bwh1.net/)
- [AlibabaCloud](https://www.alibabacloud.com/)
- [Vultr](https://www.vultr.com/)
- [Linode](https://www.linode.com/)

当然这里只是部分，也有很多其他的房地产商，这里就不一一介绍了，各位可以自行去[知乎](https://zhuanlan.zhihu.com/p/31856700)了解详情。

### 造房子
为了让小飞机更加愉快的工作，小飞机更喜欢在 Linux 下旅行，所以推荐选择 Linux 系列的房子，这里选用了 Centos 7 作为小飞机的新家。之后所有的操作都是 CentOS 7 的方法，如果用其他的房子，请参考对应的方式。
有了房子之后还需要钥匙，可以使用 [PuTTY](https://www.putty.org/) 或者 [xshell](https://www.netsarang.com/products/xsh_overview.html) 等钥匙进入房子哦！
你可以为小飞机专门给一间房，也可以就用自己房间。
进入房间的第一步便是打扫房间， CentOS 7 本来就有一套工具，称之为 `yum` ，请合理的使用它为小飞机创建一个舒适的房间吧！
```shell
yum update
yum upgrade -y
```
完成上述过程后就可以进行房间的装修了！

### 装修
```shell
yum install vim git -y
yum install epel-release -y
yum install gcc gettext autoconf libtool automake make pcre-devel asciidoc xmlto c-ares-devel libev-devel libsodium-devel mbedtls-devel -y
```

至此为小飞机安家的装修全部完成，终于可以开始最重要的一步了！

## 安装小飞机服务
### 获取小飞机
```shell
git clone https://github.com/shadowsocks/shadowsocks-libev.git
cd shadowsocks-libev
git submodule update --init --recursive
```

### 编译安装 `libsodium` 依赖
```shell
export LIBSODIUM_VER=1.0.13
wget https://download.libsodium.org/libsodium/releases/libsodium-$LIBSODIUM_VER.tar.gz
tar xvf libsodium-$LIBSODIUM_VER.tar.gz
pushd libsodium-$LIBSODIUM_VER
./configure --prefix=/usr
make && make install
popd
ldconfig
```

### 安装小飞机
```shell
./autogen.sh && ./configure --prefix=/usr
make && make install
```

### 将小飞机设置为service
```shell
vim /etc/systemd/system/shadowsocks.service
```

/etc/systemd/system/shadowsocks.service
```text
[Unit]
Description=Shadowsocks Server
After=network.target
[Service]
ExecStart=/usr/bin/ss-server -c /etc/shadowsocks-libev/config.json -u
Restart=on-abort
[Install]
WantedBy=multi-user.target
```

```shell
systemctl enable shadowsocks
```

### 配置及启用小飞机
```shell
vim /etc/shadowsocks-libev/config.json
```

/etc/shadowsocks-libev/config.json
```text
{
    "server":["[::0]","0.0.0.0"],
    "server_port":19600,
    "local_port":1080,
    "password":"silence_00",
    "timeout":60,
    "method":"chacha20-ietf-poly1305"
}
```

```shell
systemctl start shadowsocks
```

### 为小飞机打开窗户
防火墙设置更新
```shell
firewall-cmd --zone=public --add-port=19600/tcp --permanent
firewall-cmd --reload
```

### 多端口配置
小飞机可以同时被多个用户连接使用，只需要复制配置文件，然后
```bash
setsid ss-server -c /etc/shadowsocks-libev/*.json -u
```
即可添加一个新的窗户，当然，要记得去防火墙那里打开哦。

## 联系我
QQ群：["518525221"](./images/NinNin.png)